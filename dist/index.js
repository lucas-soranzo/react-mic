!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("prop-types"),require("react")):"function"==typeof define&&define.amd?define([,],t):"object"==typeof exports?exports.ReactMic=t(require("prop-types"),require("react")):e.ReactMic=t(e.PropTypes,e.React)}(window,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";n.r(t),n.d(t,"ReactMic",(function(){return _}));var r=n(1),o=n.n(r),i=n(0);let a,s=window.AudioContext||window.webkitAudioContext,c=e=>{let t=new Event("error");return t.data=new Error("Wrong state for "+e),t};class u{constructor(e,t=null){this.stream=e,this.config=t,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=(e=>{let t=e.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),n=new Blob([t]);return new Worker(URL.createObjectURL(n))})(u.encoder);let n=this;this.encoder.addEventListener("message",e=>{let t=new Event("dataavailable");t.data=new Blob([e.data],{type:n.mimeType}),n.em.dispatchEvent(t),"inactive"===n.state&&n.em.dispatchEvent(new Event("stop"))})}start(e){if("inactive"!==this.state)return this.em.dispatchEvent(c("start"));this.state="recording",a||(a=new s(this.config)),this.clone=this.stream.clone(),this.input=a.createMediaStreamSource(this.clone),this.processor=a.createScriptProcessor(2048,1,1),this.encoder.postMessage(["init",a.sampleRate]),this.processor.onaudioprocess=e=>{"recording"===this.state&&this.encoder.postMessage(["encode",e.inputBuffer.getChannelData(0)])},this.input.connect(this.processor),this.processor.connect(a.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval(()=>{"recording"===this.state&&this.requestData()},e))}stop(){return"inactive"===this.state?this.em.dispatchEvent(c("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(e=>{e.stop()}),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return"recording"!==this.state?this.em.dispatchEvent(c("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return"paused"!==this.state?this.em.dispatchEvent(c("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return"inactive"===this.state?this.em.dispatchEvent(c("requestData")):this.encoder.postMessage(["dump",a.sampleRate])}addEventListener(...e){this.em.addEventListener(...e)}removeEventListener(...e){this.em.removeEventListener(...e)}dispatchEvent(...e){this.em.dispatchEvent(...e)}}u.prototype.mimeType="audio/wav",u.isTypeSupported=e=>u.prototype.mimeType===e,u.notSupported=!navigator.mediaDevices||!s,u.encoder=()=>{let e=[];onmessage=t=>{"encode"===t.data[0]?function(t){let n=t.length,r=new Uint8Array(2*n);for(let e=0;e<n;e++){let n=2*e,o=t[e];o>1?o=1:o<-1&&(o=-1),o*=32768,r[n]=o,r[n+1]=o>>8}e.push(r)}(t.data[1]):"dump"===t.data[0]&&function(t){let n=e.length?e[0].length:0,r=e.length*n,o=new Uint8Array(44+r),i=new DataView(o.buffer);i.setUint32(0,1380533830,!1),i.setUint32(4,36+r,!0),i.setUint32(8,1463899717,!1),i.setUint32(12,1718449184,!1),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,t,!0),i.setUint32(28,2*t,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),i.setUint32(36,1684108385,!1),i.setUint32(40,r,!0);for(let t=0;t<e.length;t++)o.set(e[t],t*n+44);e=[],postMessage(o.buffer,[o.buffer])}(t.data[1])}};var l,p,d,f=u,h=new(window.AudioContext||window.webkitAudioContext),v=h.createAnalyser(),y={getAudioContext:function(){return h},getAnalyser:function(){return v},resetAnalyser:function(){v=h.createAnalyser()},decodeAudioData:function(){h.decodeAudioData(audioData).then((function(e){}))}};function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g,b,w,S,R,C,E,A,M=[];navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var U,x=function(){function e(t,n,r,o,i,a){var s,c,u,h=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u=function(){if(g=Date.now(),d){if(p&&"suspended"===p.state&&p.resume(),d&&"paused"===d.state)return void d.resume();p&&d&&"inactive"===d.state&&(d.start(10),p.createMediaStreamSource(b).connect(l),S&&S())}else navigator.mediaDevices?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia(A).then((function(e){b=e,window.MediaRecorder&&window.MediaRecorder.hasOwnProperty("isTypeSupported")?(d=MediaRecorder.isTypeSupported(w.mimeType)?new MediaRecorder(e,w):new MediaRecorder(e),S&&S(),d.onstop=h.onStop,d.ondataavailable=function(e){M.push(e.data),E&&E(e.data)},(p=y.getAudioContext()).resume().then((function(){l=y.getAnalyser(),d.start(10),p.createMediaStreamSource(b).connect(l)}))):(d=new f(e),S&&S(),d.addEventListener("stop",h.onStop),d.addEventListener("dataavailable",(function(e){console.log(e.data.type),M.push(e.data),E&&E(e.data)})),(p=y.getAudioContext()).resume().then((function(){l=y.getAnalyser(),d.start(10),p.createMediaStreamSource(b).connect(l)})))}))):alert("Your browser does not support audio recording")},(c="startRecording")in(s=this)?Object.defineProperty(s,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[c]=u;var v=a.echoCancellation,m=a.autoGainControl,U=a.noiseSuppression,x=a.channelCount;S=t,R=n,C=r,E=o,w=i,A={audio:{echoCancellation:v,autoGainControl:m,noiseSuppression:U,channelCount:x},video:!1}}var t,n,r;return t=e,(n=[{key:"stopRecording",value:function(){d&&"inactive"!==d.state&&(d.stop(),b.getAudioTracks().forEach((function(e){e.stop()})),d=null,y.resetAnalyser())}},{key:"onStop",value:function(){var e=new Blob(M,{type:w.mimeType});M=[];var t={blob:e,startTime:g,stopTime:Date.now(),options:w,blobURL:window.URL.createObjectURL(e)};R&&R(t),C&&C(t)}}])&&m(t.prototype,n),r&&m(t,r),e}(),T={create:function(e){var t=y.getAudioContext(),n=y.getAnalyser();if(void 0===U){var r=t.createMediaElementSource(e);r.connect(n),U=r}n.connect(t.destination)}},P={visualizeSineWave:function(e,t,n,r,o,i){var a=y.getAnalyser(),s=a.fftSize,c=new Uint8Array(s);e.clearRect(0,0,n,r),function u(){requestAnimationFrame(u),(a=y.getAnalyser()).getByteTimeDomainData(c),e.fillStyle=o,e.fillRect(0,0,n,r),e.lineWidth=2,e.strokeStyle=i,e.beginPath();for(var l=1*n/s,p=0,d=0;d<s;d++){var f=c[d]/128*r/2;0===d?e.moveTo(p,f):e.lineTo(p,f),p+=l}e.lineTo(t.width,t.height/2),e.stroke()}()},visualizeFrequencyBars:function(e,t,n,r,o,i){var a=this,s=y.getAnalyser();s.fftSize=256;var c=s.frequencyBinCount,u=new Uint8Array(c);e.clearRect(0,0,n,r),function t(){requestAnimationFrame(t),(s=y.getAnalyser()).getByteFrequencyData(u),e.fillStyle=o,e.fillRect(0,0,n,r);for(var l,p=n/c*2.5,d=0,f=0;f<c;f++){l=u[f];a.hexToRgb(i);e.fillStyle=i,e.fillRect(d,r-l/2,p,l/2),d+=p+1}}()},visualizeFrequencyCircles:function(e,t,n,r,o,i){var a=y.getAnalyser();a.fftSize=32;var s=a.frequencyBinCount,c=new Uint8Array(s);e.clearRect(0,0,n,r),function t(){requestAnimationFrame(t),(a=y.getAnalyser()).getByteFrequencyData(c);for(var u=new Uint8Array(s/3),l=0;l<s;l+=3){for(var p=0,d=0;d<3;d++)p+=c[l+d];u[l/3]=p/3}e.clearRect(0,0,n,r),e.beginPath(),e.arc(n/2,r/2,Math.min(r,n)/2,0,2*Math.PI),e.fillStyle=o,e.fill();var f=Math.min(r,n)/2/u.length;e.strokeStyle=i;for(var h=0;h<u.length;h++){e.beginPath();var v=f*h+f*(u[h]/128);e.arc(n/2,r/2,v,0,2*Math.PI),e.stroke()}}()},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}};function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=B(e);if(t){var o=B(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return q(this,n)}}function q(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?z(e):t}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(a,e);var t,n,r,i=j(a);function a(e){var t,n,r,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),t=i.call(this,e),n=z(t),s=function(){var e=t.props,n=e.backgroundColor,r=e.strokeColor,o=e.width,i=e.height,a=e.visualSetting,s=t.state,c=s.canvas,u=s.canvasCtx;"sinewave"===a?P.visualizeSineWave(u,c,o,i,n,r):"frequencyBars"===a?P.visualizeFrequencyBars(u,c,o,i,n,r):"frequencyCircles"===a&&P.visualizeFrequencyCircles(u,c,o,i,n,r)},(r="visualize")in n?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,t.visualizerRef=o.a.createRef(),t.state={microphoneRecorder:null,canvas:null,canvasCtx:null},t}return t=a,(n=[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.record,r=t.onStop,o=this.state.microphoneRecorder;e.record!==n&&(n?o&&o.startRecording():o&&(o.stopRecording(r),this.clear()))}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.onSave,r=t.onStop,o=t.onStart,i=t.onData,a=t.audioElem,s=t.audioBitsPerSecond,c=t.echoCancellation,u=t.autoGainControl,l=t.noiseSuppression,p=(t.channelCount,t.mimeType),d=this.visualizerRef.current,f=d.getContext("2d"),h={audioBitsPerSecond:s,mimeType:p},v={echoCancellation:c,autoGainControl:u,noiseSuppression:l};a?(T.create(a),this.setState({canvas:d,canvasCtx:f},(function(){e.visualize()}))):this.setState({microphoneRecorder:new x(o,r,n,i,h,v),canvas:d,canvasCtx:f},(function(){e.visualize()}))}},{key:"clear",value:function(){var e=this.props,t=e.width,n=e.height;this.state.canvasCtx.clearRect(0,0,t,n)}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return o.a.createElement("canvas",{ref:this.visualizerRef,height:n,width:t,className:this.props.className})}}])&&k(t.prototype,n),r&&k(t,r),a}(r.Component);_.propTypes={backgroundColor:i.string,strokeColor:i.string,className:i.string,audioBitsPerSecond:i.number,mimeType:i.string,height:i.number,record:i.bool.isRequired,onStop:i.func,onData:i.func,onSave:i.func},_.defaultProps={backgroundColor:"rgba(255, 255, 255, 0.5)",strokeColor:"#000000",className:"visualizer",audioBitsPerSecond:128e3,mimeType:"audio/webm;codecs=opus",record:!1,width:640,height:100,visualSetting:"sinewave",echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1,channelCount:2}}])}));